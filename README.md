С чего начинается разработка любого gRPC сервиса? Правильно, с написания proto-файла (Protocol Buffers, protobuf). Ближайшая аналогия из мира REST API — Swagger / OpenAPI.


Описание контракта, это, в некотором смысле, API-документация к нашему сервису, которая обязана всегда быть актуальной, и по которой можно сгенерировать и клиент, и сервер. Это очень удобно, потому что нам не нужно поддерживать где-то отдельно документацию, и мы никогда не забудем обновить контракт, т.к. сервер напрямую с ним связан благодаря кодогенерации.

Этот проект хранит proto-файлы и сгенерированный код, поскольку контракт нужен и серверу, и всем клиентам (сервисам, которые пользуются SSO). Сервисы будут подключать этот репозиторий через go.mod.

В корне проекта будет две основных папки:

proto — тут будем хранить сами proto-файлы
gen — а здесь будет сгенерированный по ним код

В папке proto/sso создаём файл sso.proto. Его формат очень прост, в нём будут описаны:

Общая информация: версия протокола, пакет и опции для генерации go-файлов
Сервисы: по сути, это аналогии интерфейсам в Go — описание сигнатур методов, которые сервис должен реализовать
Формат сообщений: объекты, которые методы сервисов будут принимать и возвращать

Внутренний сервис у нас пока будет один: Auth (в будущем можно добавить рядом Permissions и UserInfo).
